<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SchoolQuest üéÆ | Aventuras Educativas</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka+One&family=Nunito:wght@400;700;900&display=swap');

        :root {
            --primary: #FF6B8B;
            --secondary: #4ECDC4;
            --accent: #FFD166;
            --purple: #9D4EDD;
            --green: #06D6A0;
            --blue: #118AB2;
            --dark: #073B4C;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background: linear-gradient(135deg, 
                var(--primary) 0%, 
                var(--purple) 25%, 
                var(--blue) 50%, 
                var(--green) 75%, 
                var(--secondary) 100%);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            min-height: 100vh;
            padding: 10px;
            color: white;
            position: relative;
            overflow-x: hidden;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Bolhas flutuantes */
        .bubble {
            position: absolute;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            animation: float 15s infinite ease-in-out;
            z-index: -1;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        /* Header animado */
        .header {
            text-align: center;
            padding: 20px;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 25px;
            margin-bottom: 25px;
            backdrop-filter: blur(10px);
            border: 3px dashed var(--accent);
            animation: pulse 2s infinite;
            position: relative;
            overflow: hidden;
        }

        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 20px rgba(255, 255, 255, 0.3); }
            50% { box-shadow: 0 0 40px rgba(255, 255, 255, 0.6); }
        }

        .header h1 {
            font-family: 'Fredoka One', cursive;
            font-size: 42px;
            text-shadow: 3px 3px 0px var(--dark);
            background: linear-gradient(45deg, #FFD166, #FF9E6D);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
            letter-spacing: 2px;
        }

        .subtitle {
            font-size: 18px;
            color: var(--accent);
            font-weight: 700;
            margin-bottom: 15px;
        }

        .stats {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
        }

        .stat-item {
            background: rgba(255, 255, 255, 0.2);
            padding: 10px 20px;
            border-radius: 15px;
            min-width: 120px;
            border: 2px solid white;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 900;
            text-shadow: 2px 2px 0px rgba(0,0,0,0.2);
        }

        .stat-label {
            font-size: 14px;
            opacity: 0.9;
        }

        /* Anima√ß√£o de moedas */
        .coin-animation {
            position: absolute;
            width: 30px;
            height: 30px;
            background: linear-gradient(45deg, #FFD700, #FFED4E);
            border-radius: 50%;
            animation: coinFloat 1s ease-out;
            pointer-events: none;
            z-index: 100;
        }

        @keyframes coinFloat {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-100px) scale(0); opacity: 0; }
        }

        /* Cards interativos */
        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 25px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            border: 3px solid white;
            transform-style: preserve-3d;
            transition: transform 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .card:hover {
            transform: translateY(-5px) rotateX(5deg);
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border-radius: 25px 25px 0 0;
        }

        /* Bot√µes super animados */
        .btn-magic, .btn-game {
            position: relative;
            background: linear-gradient(135deg, var(--primary), var(--purple));
            color: white;
            border: none;
            padding: 18px 35px;
            border-radius: 50px;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            margin: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            font-family: 'Fredoka One', cursive;
            letter-spacing: 1px;
            overflow: hidden;
            z-index: 1;
        }

        .btn-magic::before, .btn-game::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: 0.5s;
        }

        .btn-magic:hover::before, .btn-game:hover::before {
            left: 100%;
        }

        .btn-magic:active, .btn-game:active {
            transform: scale(0.95) rotate(2deg);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .btn-magic:hover, .btn-game:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 12px 30px rgba(0,0,0,0.4);
        }

        /* √Årea de upload com drag & drop */
        .upload-area {
            border: 3px dashed var(--accent);
            border-radius: 20px;
            padding: 40px 20px;
            text-align: center;
            background: rgba(255, 255, 255, 0.9);
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 20px;
        }

        .upload-area.drag-over {
            background: rgba(255, 255, 255, 1);
            border-color: var(--green);
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 60px;
            margin-bottom: 20px;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        /* Preview da imagem */
        .preview-container {
            position: relative;
            margin: 20px 0;
        }

        .preview-img {
            width: 100%;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
            border: 5px solid white;
            animation: photoPop 0.5s ease-out;
        }

        @keyframes photoPop {
            0% { transform: scale(0.8); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        /* Game container - √Årea do jogo */
        .game-container {
            background: linear-gradient(135deg, rgba(255,255,255,0.95), rgba(255,255,255,0.98));
            border-radius: 30px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.25);
            border: 5px solid var(--accent);
            position: relative;
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 3px dotted var(--primary);
        }

        .question-counter {
            background: var(--primary);
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 18px;
            box-shadow: 0 4px 10px rgba(255,107,139,0.4);
        }

        .difficulty-badge {
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 16px;
            text-transform: uppercase;
            letter-spacing: 1px;
            animation: glow 2s infinite alternate;
        }

        @keyframes glow {
            from { box-shadow: 0 0 10px currentColor; }
            to { box-shadow: 0 0 20px currentColor; }
        }

        .difficulty-f√°cil {
            background: var(--green);
            color: white;
        }

        .difficulty-m√©dio {
            background: var(--accent);
            color: var(--dark);
        }

        .difficulty-dif√≠cil {
            background: var(--primary);
            color: white;
        }

        /* Quest√£o estilizada */
        .question-card {
            background: linear-gradient(135deg, #FFFAF0, #FFF5E1);
            padding: 25px;
            border-radius: 20px;
            margin: 25px 0;
            border-left: 10px solid var(--secondary);
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
            transform-style: preserve-3d;
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from { transform: translateX(-50px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .question-text {
            font-size: 24px;
            font-weight: 700;
            color: var(--dark);
            line-height: 1.4;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }

        .question-emoji {
            font-size: 40px;
            margin-right: 15px;
            vertical-align: middle;
            animation: spinEmoji 3s infinite linear;
        }

        @keyframes spinEmoji {
            0% { transform: rotate(0deg) scale(1); }
            50% { transform: rotate(180deg) scale(1.1); }
            100% { transform: rotate(360deg) scale(1); }
        }

        /* Op√ß√µes de resposta */
        .options-grid {
            display: grid;
            gap: 15px;
            margin: 25px 0;
        }

        .option-btn {
            padding: 20px;
            background: white;
            border: 3px solid var(--secondary);
            border-radius: 15px;
            font-size: 18px;
            font-weight: 600;
            color: var(--dark);
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            position: relative;
            overflow: hidden;
        }

        .option-btn::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 0;
            background: linear-gradient(90deg, transparent, rgba(78, 205, 196, 0.2), transparent);
            transition: width 0.5s;
        }

        .option-btn:hover::before {
            width: 100%;
        }

        .option-btn:hover {
            transform: translateX(10px) scale(1.02);
            border-color: var(--primary);
            box-shadow: 0 8px 20px rgba(255,107,139,0.2);
        }

        .option-btn:active {
            transform: scale(0.98);
        }

        .option-btn.correct {
            background: var(--green);
            color: white;
            border-color: #00b894;
            animation: correctPop 0.5s;
        }

        @keyframes correctPop {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .option-btn.wrong {
            background: var(--primary);
            color: white;
            border-color: #d63031;
            animation: wrongShake 0.5s;
        }

        @keyframes wrongShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        /* Feedback animado */
        .feedback-container {
            padding: 25px;
            border-radius: 20px;
            margin: 25px 0;
            animation: feedbackAppear 0.5s ease-out;
            text-align: center;
            font-size: 20px;
            font-weight: bold;
        }

        @keyframes feedbackAppear {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .feedback-correct {
            background: linear-gradient(135deg, var(--green), #00b894);
            color: white;
            border: 3px solid #00b894;
        }

        .feedback-wrong {
            background: linear-gradient(135deg, var(--primary), #d63031);
            color: white;
            border: 3px solid #d63031;
        }

        .explanation {
            font-size: 16px;
            font-weight: normal;
            margin-top: 15px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            text-align: left;
        }

        /* Barra de progresso */
        .progress-container {
            background: rgba(255, 255, 255, 0.3);
            height: 25px;
            border-radius: 12px;
            overflow: hidden;
            margin: 20px 0;
            border: 2px solid white;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, 
                var(--primary) 0%, 
                var(--purple) 33%, 
                var(--secondary) 66%, 
                var(--green) 100%);
            background-size: 200% 100%;
            animation: progressGradient 2s linear infinite;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }

        @keyframes progressGradient {
            0% { background-position: 0% 50%; }
            100% { background-position: 200% 50%; }
        }

        /* Loading animado */
        .loading-container {
            text-align: center;
            padding: 50px 20px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 25px;
            margin: 20px 0;
        }

        .magic-spinner {
            width: 80px;
            height: 80px;
            margin: 20px auto;
            position: relative;
        }

        .magic-spinner::before,
        .magic-spinner::after {
            content: '';
            position: absolute;
            border-radius: 50%;
            border: 5px solid transparent;
        }

        .magic-spinner::before {
            width: 100%;
            height: 100%;
            border-top-color: var(--primary);
            border-bottom-color: var(--purple);
            animation: spin 1s linear infinite;
        }

        .magic-spinner::after {
            width: 70%;
            height: 70%;
            top: 15%;
            left: 15%;
            border-top-color: var(--secondary);
            border-bottom-color: var(--green);
            animation: spinReverse 1.5s linear infinite;
        }

        /* Tela final com confete */
        .final-screen {
            background: linear-gradient(135deg, 
                rgba(255, 255, 255, 0.95), 
                rgba(255, 255, 255, 0.98));
            border-radius: 30px;
            padding: 40px 30px;
            text-align: center;
            color: var(--dark);
            position: relative;
            overflow: hidden;
            margin: 20px 0;
        }

        .final-screen::before {
            content: 'üéâ üèÜ ‚ú®';
            position: absolute;
            top: 20px;
            left: 0;
            right: 0;
            font-size: 60px;
            opacity: 0.1;
            z-index: 0;
        }

        .trophy {
            font-size: 80px;
            margin-bottom: 20px;
            animation: trophyBounce 1s infinite alternate;
            position: relative;
            z-index: 1;
        }

        @keyframes trophyBounce {
            from { transform: translateY(0); }
            to { transform: translateY(-20px); }
        }

        .score-display {
            font-size: 48px;
            font-weight: 900;
            background: linear-gradient(45deg, var(--primary), var(--purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 20px 0;
            position: relative;
            z-index: 1;
        }

        .final-message {
            font-size: 24px;
            margin: 25px 0;
            padding: 20px;
            background: linear-gradient(135deg, var(--accent), #FFB347);
            border-radius: 20px;
            color: white;
            position: relative;
            z-index: 1;
        }

        /* Classes utilit√°rias */
        .hidden {
            display: none !important;
        }

        .visible {
            display: block !important;
        }

        .shake {
            animation: shake 0.5s;
        }

        .bounce-in {
            animation: bounceIn 0.5s;
        }

        @keyframes bounceIn {
            0% { transform: scale(0); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        /* Responsividade */
        @media (max-width: 600px) {
            .header h1 { font-size: 32px; }
            .question-text { font-size: 20px; }
            .btn-magic, .btn-game { padding: 15px 25px; font-size: 18px; }
            .stat-item { min-width: 100px; }
        }

        /* Emoji animado */
        .animated-emoji {
            display: inline-block;
            animation: wave 1s infinite;
        }

        @keyframes wave {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(10deg); }
            75% { transform: rotate(-10deg); }
        }

        /* Efeito de part√≠culas */
        .particle {
            position: absolute;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            pointer-events: none;
            z-index: 100;
            animation: particleFly 1s ease-out forwards;
        }

        @keyframes particleFly {
            0% { transform: translate(0, 0) scale(1); opacity: 1; }
            100% { transform: translate(var(--tx, 0), var(--ty, -100px)) scale(0); opacity: 0; }
        }
    </style>
</head>
<body>
    <!-- Bolhas de fundo -->
    <div class="bubbles"></div>

    <div class="container">
        <!-- Header animado -->
        <header class="header">
            <h1>üéÆ SchoolQuest</h1>
            <div class="subtitle">Aventuras M√°gicas no Mundo do Conhecimento!</div>
            
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-value" id="pointsDisplay">0</div>
                    <div class="stat-label">Pontos üèÜ</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="starsDisplay">‚≠ê‚≠ê‚≠ê</div>
                    <div class="stat-label">Estrelas ‚≠ê</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="levelDisplay">1</div>
                    <div class="stat-label">N√≠vel üìà</div>
                </div>
            </div>

            <div class="progress-container">
                <div class="progress-bar" id="progressBar" style="width: 0%">0%</div>
            </div>
        </header>

        <!-- Card principal de upload -->
        <div class="card" id="uploadCard">
            <h2 style="color: var(--primary); text-align: center; margin-bottom: 25px; font-size: 28px;">
                <span class="animated-emoji">üìö</span> Vamos Aprender Brincando Ana, Levi e Jo√£o?
            </h2>

            <!-- Tabs para imagem/texto -->
            <div class="tab-buttons" style="display: flex; gap: 10px; margin-bottom: 25px;">
                <button class="btn-game active" onclick="showTab('image')" style="flex: 1;">
                    üì∑ Foto M√°gica
                </button>
                <button class="btn-game" onclick="showTab('text')" style="flex: 1;">
                    ‚úèÔ∏è Texto Encantado
                </button>
            </div>

            <!-- √Årea de upload de imagem -->
            <div id="imageTab">
                <div class="upload-area" id="dropArea">
                    <div class="upload-icon">üì∏</div>
                    <h3 style="color: var(--dark); margin-bottom: 10px;">Arraste uma foto aqui</h3>
                    <p style="color: #666; margin-bottom: 20px;">Ou clique para selecionar do seu dispositivo</p>
                    <button class="btn-magic" onclick="document.getElementById('fileInput').click()">
                        üßô‚Äç‚ôÇÔ∏è Abrir C√¢mera M√°gica
                    </button>
                    <input type="file" id="fileInput" accept="image/*" capture="environment" class="hidden">
                </div>

                <div class="preview-container hidden" id="previewContainer">
                    <img id="previewImage" class="preview-img" alt="Pr√©via da imagem">
                    <div style="margin-top: 20px; text-align: center;">
                        <button class="btn-magic" id="processImageBtn" onclick="processImage()" 
                                style="display: block; margin: 20px auto;">
                            ü™Ñ Transformar em Jogo M√°gico!
                        </button>
                    </div>
                </div>
            </div>

            <!-- √Årea de texto -->
            <div id="textTab" class="hidden">
                <div style="background: linear-gradient(135deg, #F0F9FF, #E6F7FF); padding: 25px; border-radius: 20px;">
                    <h3 style="color: var(--dark); margin-bottom: 15px;">
                        <span class="animated-emoji">üìù</span> Cole seu texto m√°gico
                    </h3>
                    <textarea id="textInput" 
                              placeholder="Digite ou cole o texto do dever de casa aqui... ‚ú®"
                              style="width: 100%; min-height: 150px; padding: 15px; border: 3px solid var(--secondary); border-radius: 15px; font-size: 16px; font-family: inherit; resize: vertical; margin-bottom: 20px;"></textarea>
                    <button class="btn-magic" onclick="processText()">
                        üéØ Criar Desafio de Conhecimento!
                    </button>
                </div>
            </div>
        </div>

        <!-- Loading screen -->
        <div class="loading-container hidden" id="loadingScreen">
            <div class="magic-spinner"></div>
            <h3 style="color: var(--primary); margin: 20px 0;">Preparando a Magia do Aprendizado! ‚ú®</h3>
            <p style="color: #666;">Criando perguntas m√°gicas para voc√™...</p>
            <div style="margin-top: 30px; display: flex; justify-content: center; gap: 10px;">
                <div style="width: 10px; height: 10px; background: var(--primary); border-radius: 50%; animation: bounce 1s infinite;"></div>
                <div style="width: 10px; height: 10px; background: var(--purple); border-radius: 50%; animation: bounce 1s infinite 0.2s;"></div>
                <div style="width: 10px; height: 10px; background: var(--secondary); border-radius: 50%; animation: bounce 1s infinite 0.4s;"></div>
            </div>
        </div>

        <!-- √Årea do jogo -->
        <div id="gameArea"></div>

        <!-- Tela final -->
        <div id="finalScreen" class="hidden"></div>
    </div>

    <script>
        // Vari√°veis do jogo
        let currentQuestions = [];
        let currentQuestionIndex = 0;
        let totalPoints = 0;
        let stars = 3;
        let level = 1;
        let uploadedImage = null;

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            createBubbles();
            setupDragAndDrop();
            checkAPIHealth();
            updateDisplay();
            
            // Configurar evento do input de arquivo
            document.getElementById('fileInput').addEventListener('change', handleFileSelect);
        });

        // Criar bolhas animadas
        function createBubbles() {
            const bubbleContainer = document.querySelector('.bubbles');
            for (let i = 0; i < 15; i++) {
                const bubble = document.createElement('div');
                bubble.className = 'bubble';
                bubble.style.width = `${Math.random() * 60 + 20}px`;
                bubble.style.height = bubble.style.width;
                bubble.style.left = `${Math.random() * 100}%`;
                bubble.style.top = `${Math.random() * 100}%`;
                bubble.style.animationDelay = `${Math.random() * 5}s`;
                bubble.style.animationDuration = `${Math.random() * 10 + 10}s`;
                bubbleContainer.appendChild(bubble);
            }
        }

        // Mostrar/ocultar tabs
        function showTab(tabName) {
            // Atualizar bot√µes ativos
            document.querySelectorAll('.tab-buttons .btn-game').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Mostrar tab correta
            if (tabName === 'image') {
                document.getElementById('imageTab').classList.remove('hidden');
                document.getElementById('textTab').classList.add('hidden');
            } else {
                document.getElementById('imageTab').classList.add('hidden');
                document.getElementById('textTab').classList.remove('hidden');
            }
        }

        // Configurar drag & drop
        function setupDragAndDrop() {
            const dropArea = document.getElementById('dropArea');
            if (!dropArea) return;

            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropArea.addEventListener(eventName, preventDefaults, false);
            });

            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }

            ['dragenter', 'dragover'].forEach(eventName => {
                dropArea.addEventListener(eventName, highlight, false);
            });

            ['dragleave', 'drop'].forEach(eventName => {
                dropArea.addEventListener(eventName, unhighlight, false);
            });

            function highlight() {
                dropArea.classList.add('drag-over');
            }

            function unhighlight() {
                dropArea.classList.remove('drag-over');
            }

            dropArea.addEventListener('drop', handleDrop, false);

            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                if (files.length > 0) {
                    handleFileUpload(files[0]);
                }
            }
        }

        // Manipular sele√ß√£o de arquivo
        function handleFileSelect(e) {
            const file = e.target.files[0];
            if (file) {
                handleFileUpload(file);
            }
        }

        // Upload de arquivo
        function handleFileUpload(file) {
            uploadedImage = file;
            const reader = new FileReader();
            
            reader.onload = function(event) {
                const preview = document.getElementById('previewImage');
                const container = document.getElementById('previewContainer');
                const dropArea = document.getElementById('dropArea');
                
                if (preview && container && dropArea) {
                    preview.src = event.target.result;
                    container.classList.remove('hidden');
                    dropArea.classList.add('hidden');
                    
                    // Animar a pr√©via
                    preview.style.animation = 'photoPop 0.5s ease-out';
                    
                    // Garantir que o bot√£o est√° vis√≠vel
                    const processBtn = document.getElementById('processImageBtn');
                    if (processBtn) {
                        processBtn.style.display = 'block';
                        processBtn.style.visibility = 'visible';
                        processBtn.style.opacity = '1';
                    }
                }
            };
            
            reader.readAsDataURL(file);
        }

        // Criar part√≠culas
        function createParticles(x, y, count = 10, color = '#FFD700') {
            for (let i = 0; i < count; i++) {
                setTimeout(() => {
                    const particle = document.createElement('div');
                    particle.className = 'particle';
                    particle.style.background = color;
                    particle.style.left = `${x}px`;
                    particle.style.top = `${y}px`;
                    
                    const angle = Math.random() * Math.PI * 2;
                    const speed = Math.random() * 100 + 50;
                    const tx = Math.cos(angle) * speed;
                    const ty = Math.sin(angle) * speed;
                    
                    particle.style.setProperty('--tx', `${tx}px`);
                    particle.style.setProperty('--ty', `${ty}px`);
                    
                    document.body.appendChild(particle);
                    setTimeout(() => particle.remove(), 1000);
                }, i * 50);
            }
        }

        // Verificar sa√∫de da API
        async function checkAPIHealth() {
            try {
                const response = await fetch('/api/health');
                const data = await response.json();
                console.log('‚úÖ API conectada:', data);
            } catch (error) {
                console.error('‚ùå Erro na API:', error);
            }
        }

        // Processar imagem - FUN√á√ÉO CORRIGIDA
        async function processImage() {
            console.log('üéÆ Bot√£o "Transformar em Jogo" clicado!');
            
            if (!uploadedImage) {
                alert('üì∏ Por favor, selecione uma imagem primeiro!');
                return;
            }

            // Mostrar loading
            document.getElementById('uploadCard').classList.add('hidden');
            document.getElementById('loadingScreen').classList.remove('hidden');

            try {
                const formData = new FormData();
                formData.append('file', uploadedImage);

                console.log('üì§ Enviando imagem para API...');
                const response = await fetch('/api/process-image', {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.detail || 'Erro ao processar imagem');
                }

                const gameData = await response.json();
                console.log('‚úÖ Jogo criado com sucesso!', gameData);
                
                currentQuestions = gameData.questions || [];
                currentQuestionIndex = 0;
                totalPoints = 0;
                stars = 3;
                
                // Esconder loading
                document.getElementById('loadingScreen').classList.add('hidden');
                
                // Mostrar primeira quest√£o
                if (currentQuestions.length > 0) {
                    showQuestion();
                } else {
                    throw new Error('Nenhuma quest√£o foi gerada');
                }
                
            } catch (error) {
                console.error('‚ùå Erro:', error);
                
                // Mostrar erro
                document.getElementById('loadingScreen').innerHTML = `
                    <div style="text-align: center; padding: 40px;">
                        <div style="font-size: 60px; margin-bottom: 20px;">üòü</div>
                        <h3 style="color: var(--primary);">Ops! Algo deu errado</h3>
                        <p style="color: #666; margin: 20px 0;">${error.message}</p>
                        <button class="btn-magic" onclick="location.reload()">
                            üîÑ Tentar Novamente
                        </button>
                    </div>
                `;
            }
        }

        // Processar texto
        async function processText() {
            const text = document.getElementById('textInput').value.trim();
            if (!text) {
                alert('‚úèÔ∏è Digite ou cole o texto do dever de casa!');
                return;
            }

            // Mostrar loading
            document.getElementById('uploadCard').classList.add('hidden');
            document.getElementById('loadingScreen').classList.remove('hidden');

            try {
                const response = await fetch('/api/process-text', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ text })
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.detail || 'Erro ao processar texto');
                }

                const gameData = await response.json();
                currentQuestions = gameData.questions || [];
                currentQuestionIndex = 0;
                totalPoints = 0;
                stars = 3;
                
                // Esconder loading
                document.getElementById('loadingScreen').classList.add('hidden');
                
                // Mostrar primeira quest√£o
                if (currentQuestions.length > 0) {
                    showQuestion();
                } else {
                    throw new Error('Nenhuma quest√£o foi gerada');
                }
                
            } catch (error) {
                console.error('Erro:', error);
                
                // Mostrar erro
                document.getElementById('loadingScreen').innerHTML = `
                    <div style="text-align: center; padding: 40px;">
                        <div style="font-size: 60px; margin-bottom: 20px;">üòü</div>
                        <h3 style="color: var(--primary);">Ops! Algo deu errado</h3>
                        <p style="color: #666; margin: 20px 0;">${error.message}</p>
                        <button class="btn-magic" onclick="location.reload()">
                            üîÑ Tentar Novamente
                        </button>
                    </div>
                `;
            }
        }

        // Mostrar quest√£o
        function showQuestion() {
            if (currentQuestionIndex >= currentQuestions.length) {
                showFinalScore();
                return;
            }

            const question = currentQuestions[currentQuestionIndex];
            const progress = ((currentQuestionIndex) / currentQuestions.length) * 100;
            
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('progressBar').textContent = Math.round(progress) + '%';

            const gameArea = document.getElementById('gameArea');
            gameArea.innerHTML = `
                <div class="game-container bounce-in">
                    <div class="question-header">
                        <div class="question-counter">
                            Quest√£o ${currentQuestionIndex + 1} de ${currentQuestions.length}
                        </div>
                        <div class="difficulty-badge difficulty-${question.difficulty || 'f√°cil'}">
                            ${question.difficulty || 'f√°cil'}
                        </div>
                    </div>

                    <div class="question-card">
                        <div class="question-text">
                            <span class="question-emoji">üß†</span>
                            ${question.question}
                        </div>
                    </div>

                    <div class="options-grid" id="optionsGrid"></div>

                    <div id="feedbackArea"></div>
                </div>
            `;

            const optionsGrid = document.getElementById('optionsGrid');
            const emojis = ['üÖ∞Ô∏è', 'üÖ±Ô∏è', 'üÖ≤Ô∏è', 'üÖ≥Ô∏è'];
            
            question.options.forEach((option, index) => {
                const optionBtn = document.createElement('button');
                optionBtn.className = 'option-btn';
                optionBtn.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <div style="font-size: 24px;">${emojis[index]}</div>
                        <div style="flex: 1; text-align: left;">${option}</div>
                    </div>
                `;
                optionBtn.onclick = () => checkAnswer(index, question);
                optionsGrid.appendChild(optionBtn);
            });

            // Atualizar display
            updateDisplay();
        }

        // Verificar resposta
        function checkAnswer(selectedIndex, question) {
            const options = document.querySelectorAll('.option-btn');
            const feedbackArea = document.getElementById('feedbackArea');
            
            // Desabilitar clicks
            options.forEach(opt => opt.onclick = null);

            if (selectedIndex === question.correct) {
                // Resposta correta
                options[selectedIndex].classList.add('correct');
                totalPoints += question.points || 10;
                
                feedbackArea.innerHTML = `
                    <div class="feedback-container feedback-correct">
                        <div style="font-size: 32px; margin-bottom: 10px;">üéâ Parab√©ns! üéâ</div>
                        <div style="font-size: 24px;">+${question.points || 10} pontos m√°gicos!</div>
                        <div class="explanation">
                            <strong>‚ú® Explica√ß√£o M√°gica:</strong><br>
                            ${question.explanation || 'Voc√™ acertou!'}
                        </div>
                        <button class="btn-magic" onclick="nextQuestion()" style="margin-top: 20px;">
                            Pr√≥ximo Desafio üöÄ
                        </button>
                    </div>
                `;
                
                // Efeito visual
                createParticles(window.innerWidth / 2, window.innerHeight / 2, 15, '#06D6A0');
                
            } else {
                // Resposta errada
                options[selectedIndex].classList.add('wrong');
                options[question.correct].classList.add('correct');
                stars = Math.max(0, stars - 1);
                
                feedbackArea.innerHTML = `
                    <div class="feedback-container feedback-wrong">
                        <div style="font-size: 32px; margin-bottom: 10px;">üí° Quase l√°! üí°</div>
                        <div style="font-size: 24px;">Resposta correta: ${question.options[question.correct]}</div>
                        <div class="explanation">
                            <strong>üìö Vamos aprender:</strong><br>
                            ${question.explanation || 'Tente novamente!'}
                        </div>
                        <button class="btn-magic" onclick="nextQuestion()" style="margin-top: 20px;">
                            Continuar Aventura ‚è≠Ô∏è
                        </button>
                    </div>
                `;
                
                // Efeito visual
                createParticles(window.innerWidth / 2, window.innerHeight / 2, 10, '#FF6B8B');
            }

            // Atualizar n√≠vel
            level = Math.floor(totalPoints / 100) + 1;
            updateDisplay();
        }

        // Pr√≥xima quest√£o
        function nextQuestion() {
            currentQuestionIndex++;
            showQuestion();
        }

        // Atualizar display
        function updateDisplay() {
            document.getElementById('pointsDisplay').textContent = totalPoints;
            document.getElementById('starsDisplay').textContent = '‚≠ê'.repeat(stars) + '‚òÜ'.repeat(3 - stars);
            document.getElementById('levelDisplay').textContent = level;
        }

        // Mostrar tela final
        function showFinalScore() {
            const totalPossible = currentQuestions.reduce((sum, q) => sum + (q.points || 10), 0);
            const percentage = totalPossible > 0 ? Math.round((totalPoints / totalPossible) * 100) : 0;
            
            let message = '';
            let trophy = '';
            
            if (percentage >= 90) {
                message = 'üèÜ Mestre do Conhecimento! üèÜ<br>Voc√™ √© incr√≠vel!';
                trophy = 'üèÜ';
            } else if (percentage >= 70) {
                message = 'üåü Super Aprendiz! üåü<br>Continue assim!';
                trophy = 'üåü';
            } else {
                message = 'üí™ Bom Trabalho! üí™<br>Cada erro √© uma chance de aprender!';
                trophy = 'üí™';
            }

            const finalScreen = document.getElementById('finalScreen');
            finalScreen.innerHTML = `
                <div class="final-screen bounce-in">
                    <div class="trophy">${trophy}</div>
                    <h2 style="color: var(--primary); font-size: 36px; margin-bottom: 20px;">
                        Miss√£o Conclu√≠da! ‚ú®
                    </h2>
                    
                    <div class="score-display">
                        ${totalPoints} Pontos
                    </div>
                    
                    <div style="margin: 30px 0;">
                        <div style="font-size: 24px; color: #666; margin-bottom: 10px;">
                            N√≠vel: <strong style="color: var(--primary);">${level}</strong>
                        </div>
                        <div style="font-size: 24px; color: #666;">
                            Estrelas: <strong style="color: #FFD700;">${'‚≠ê'.repeat(stars)}</strong>
                        </div>
                    </div>
                    
                    <div class="final-message">
                        ${message}
                    </div>
                    
                    <div style="margin-top: 40px; display: flex; gap: 15px; justify-content: center;">
                        <button class="btn-magic" onclick="restartGame()">
                            üéÆ Nova Aventura
                        </button>
                    </div>
                </div>
            `;
            
            finalScreen.classList.remove('hidden');
            
            // Atualizar barra de progresso para 100%
            document.getElementById('progressBar').style.width = '100%';
            document.getElementById('progressBar').textContent = '100%';
        }

        // Reiniciar jogo
        function restartGame() {
            currentQuestions = [];
            currentQuestionIndex = 0;
            totalPoints = 0;
            stars = 3;
            level = 1;
            uploadedImage = null;
            
            document.getElementById('finalScreen').classList.add('hidden');
            document.getElementById('gameArea').innerHTML = '';
            document.getElementById('uploadCard').classList.remove('hidden');
            document.getElementById('previewContainer').classList.add('hidden');
            document.getElementById('dropArea').classList.remove('hidden');
            document.getElementById('textInput').value = '';
            document.getElementById('fileInput').value = '';
            
            updateDisplay();
        }
    </script>
</body>
</html>