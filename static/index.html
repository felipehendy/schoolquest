<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>üéÆ SchoolQuest - Aprender √© Divertido!</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            --primary: #FF6B9D;
            --secondary: #4ECDC4;
            --accent: #FFC93C;
            --success: #06D6A0;
            --error: #FF6B8B;
            --purple: #9D4EDD;
            --blue: #3A86FF;
            --orange: #FF6B35;
            --dark: #2D3748;
            --light: #F7FAFC;
        }

        body {
            font-family: 'Comic Sans MS', 'Segoe UI Emoji', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 15px;
            color: var(--dark);
            overflow-x: hidden;
        }

        /* ========== ANIMA√á√ïES DE FUNDO ========== */
        .floating-shapes {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
            overflow: hidden;
        }

        .shape {
            position: absolute;
            opacity: 0.6;
            animation: float 6s ease-in-out infinite;
        }

        .shape:nth-child(1) { left: 10%; top: 20%; animation-delay: 0s; }
        .shape:nth-child(2) { left: 70%; top: 10%; animation-delay: 1s; }
        .shape:nth-child(3) { left: 20%; top: 60%; animation-delay: 2s; }
        .shape:nth-child(4) { left: 80%; top: 70%; animation-delay: 3s; }
        .shape:nth-child(5) { left: 50%; top: 40%; animation-delay: 4s; }

        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(10deg); }
        }

        .container {
            max-width: 700px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        /* ========== HEADER ========== */
        .header {
            background: white;
            border-radius: 25px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.2);
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,107,157,0.1), transparent);
            transform: rotate(45deg);
            animation: shine 3s infinite;
        }

        @keyframes shine {
            0%, 100% { transform: translateX(-100%) rotate(45deg); }
            50% { transform: translateX(100%) rotate(45deg); }
        }

        .logo {
            font-size: 42px;
            font-weight: 900;
            background: linear-gradient(135deg, var(--primary), var(--purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 8px;
            position: relative;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-8px); }
        }

        .subtitle {
            color: #718096;
            font-size: 15px;
            margin-bottom: 15px;
        }

        .user-info {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .user-badge {
            background: linear-gradient(135deg, var(--purple), var(--blue));
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .btn-logout {
            padding: 8px 16px;
            border-radius: 20px;
            border: none;
            background: linear-gradient(135deg, #FF6B8B, #FF8FA3);
            color: white;
            cursor: pointer;
            font-weight: 700;
            font-size: 13px;
            transition: all 0.3s;
        }

        .btn-logout:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(255,107,139,0.4);
        }

        /* ========== STATS ========== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        .stat-card {
            background: linear-gradient(135deg, #fff, #f8f9fa);
            padding: 15px 10px;
            border-radius: 15px;
            border: 3px solid #E2E8F0;
            text-align: center;
            transition: all 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
        }

        .stat-value {
            font-size: 28px;
            font-weight: 900;
            background: linear-gradient(135deg, var(--primary), var(--purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .stat-label {
            font-size: 12px;
            color: #718096;
            margin-top: 5px;
            font-weight: 600;
        }

        /* ========== PROGRESS BAR ========== */
        .progress-wrapper {
            background: rgba(255,255,255,0.3);
            height: 15px;
            border-radius: 20px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--success), var(--secondary));
            border-radius: 20px;
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            width: 0%;
            position: relative;
            overflow: hidden;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* ========== CARDS ========== */
        .card {
            background: white;
            border-radius: 25px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
            animation: slideUp 0.5s ease-out;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card-title {
            font-size: 24px;
            font-weight: 900;
            color: var(--dark);
            margin-bottom: 20px;
            text-align: center;
        }

        /* ========== BUTTONS ========== */
        .btn {
            font-family: 'Comic Sans MS', sans-serif;
            font-size: 16px;
            padding: 15px 25px;
            border-radius: 50px;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 700;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn:active {
            transform: scale(0.95);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), #FF8FB9);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(255,107,157,0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, var(--secondary), #6FE3DB);
            color: white;
        }

        .btn-accent {
            background: linear-gradient(135deg, var(--accent), #FFD700);
            color: var(--dark);
        }

        .btn-full {
            width: 100%;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .btn-group .btn {
            flex: 1;
        }

        /* ========== TABS ========== */
        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            background: #F7FAFC;
            padding: 5px;
            border-radius: 15px;
        }

        .tab-btn {
            flex: 1;
            padding: 12px;
            border-radius: 12px;
            border: none;
            background: transparent;
            cursor: pointer;
            font-size: 14px;
            font-weight: 700;
            transition: all 0.3s;
            color: #718096;
        }

        .tab-btn.active {
            background: linear-gradient(135deg, var(--primary), #FF8FB9);
            color: white;
            box-shadow: 0 5px 15px rgba(255,107,157,0.3);
        }

        /* ========== UPLOAD ZONE ========== */
        .upload-zone {
            border: 4px dashed var(--accent);
            border-radius: 20px;
            padding: 40px 20px;
            text-align: center;
            background: linear-gradient(135deg, #FFF9E6, #FFFBF0);
            cursor: pointer;
            transition: all 0.3s;
        }

        .upload-zone:hover {
            border-color: var(--primary);
            background: linear-gradient(135deg, #FFF5E1, #FFF9E6);
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 70px;
            margin-bottom: 15px;
            animation: bounce 2s infinite;
        }

        .upload-text {
            font-size: 18px;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 8px;
        }

        .upload-hint {
            font-size: 14px;
            color: #718096;
        }

        /* ========== PREVIEW ========== */
        .preview {
            position: relative;
            margin: 20px 0;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }

        .preview img {
            width: 100%;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        /* ========== TEXT INPUT ========== */
        .text-input {
            width: 100%;
            min-height: 150px;
            padding: 15px;
            border: 3px solid #E2E8F0;
            border-radius: 15px;
            font-family: 'Comic Sans MS', sans-serif;
            font-size: 16px;
            resize: vertical;
            transition: all 0.3s;
        }

        .text-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(255,107,157,0.1);
        }

        /* ========== LOADING ========== */
        .loading {
            text-align: center;
            padding: 60px 20px;
        }

        .spinner {
            width: 70px;
            height: 70px;
            margin: 0 auto 20px;
            border: 6px solid #E2E8F0;
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 20px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 10px;
        }

        .loading-hint {
            font-size: 15px;
            color: #718096;
        }

        /* ========== MODE SELECTOR ========== */
        .mode-selector {
            background: linear-gradient(135deg, #F3E8FF, #E9D5FF);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .mode-title {
            font-size: 22px;
            font-weight: 900;
            color: var(--dark);
            margin-bottom: 15px;
            text-align: center;
        }

        .mode-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 15px;
        }

        .mode-card {
            background: white;
            border: 4px solid #E2E8F0;
            border-radius: 20px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .mode-card:hover {
            border-color: var(--primary);
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }

        .mode-icon {
            font-size: 50px;
            margin-bottom: 10px;
        }

        .mode-label {
            font-size: 15px;
            font-weight: 700;
            color: var(--dark);
        }

        /* ========== GAME AREA ========== */
        .game {
            animation: slideUp 0.5s;
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 3px dashed #E2E8F0;
        }

        .question-counter {
            background: var(--primary);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: 900;
            font-size: 15px;
        }

        .difficulty {
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: 900;
            font-size: 13px;
            text-transform: uppercase;
        }

        .difficulty-f√°cil {
            background: #D1FAE5;
            color: #065F46;
        }

        .difficulty-m√©dio {
            background: #FEF3C7;
            color: #78350F;
        }

        .difficulty-dif√≠cil {
            background: #FEE2E2;
            color: #991B1B;
        }

        .question-box {
            background: linear-gradient(135deg, #E0F2FE, #DBEAFE);
            padding: 25px;
            border-radius: 20px;
            margin-bottom: 20px;
            border-left: 6px solid var(--secondary);
        }

        .question-text {
            font-size: 20px;
            font-weight: 700;
            color: var(--dark);
            line-height: 1.6;
        }

        /* ========== OPTIONS ========== */
        .options {
            display: grid;
            gap: 12px;
        }

        .option {
            padding: 18px;
            background: white;
            border: 4px solid #E2E8F0;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 16px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .option:hover {
            border-color: var(--primary);
            transform: translateX(8px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .option-letter {
            width: 45px;
            height: 45px;
            background: linear-gradient(135deg, var(--primary), var(--purple));
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            font-size: 20px;
            flex-shrink: 0;
        }

        .option.correct {
            background: var(--success);
            color: white;
            border-color: var(--success);
            animation: pulse 0.5s;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .option.correct .option-letter {
            background: white;
            color: var(--success);
        }

        .option.wrong {
            background: var(--error);
            color: white;
            border-color: var(--error);
            animation: shake 0.5s;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .option.wrong .option-letter {
            background: white;
            color: var(--error);
        }

        /* ========== COMPLETAR FRASE ========== */
        .fill-blank-container {
            background: linear-gradient(135deg, #FFF9E6, #FFFBF0);
            padding: 25px;
            border-radius: 20px;
            margin-bottom: 20px;
        }

        .sentence-with-blank {
            font-size: 19px;
            line-height: 1.8;
            color: var(--dark);
            margin-bottom: 20px;
            font-weight: 600;
        }

        .blank-space {
            display: inline-block;
            min-width: 150px;
            padding: 5px 15px;
            border-bottom: 4px dashed var(--primary);
            font-weight: 900;
            color: var(--primary);
            background: white;
            border-radius: 8px;
        }

        /* ========== MEM√ìRIA ========== */
        .memory-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin: 20px 0;
        }

        .memory-card {
            aspect-ratio: 1;
            background: linear-gradient(135deg, var(--primary), var(--purple));
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.3s;
            color: white;
            font-weight: 700;
            padding: 10px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .memory-card:hover:not(.matched) {
            transform: scale(1.1);
        }

        .memory-card.flipped {
            background: white;
            border: 4px solid var(--secondary);
            color: var(--dark);
        }

        .memory-card.matched {
            background: var(--success);
            color: white;
            cursor: default;
            opacity: 0.6;
        }

        /* ========== LIGAR PONTOS ========== */
        .connect-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin: 20px 0;
        }

        .connect-column {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .connect-item {
            padding: 15px;
            background: white;
            border: 4px solid #E2E8F0;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
            font-weight: 600;
            text-align: center;
        }

        .connect-item:hover:not(.matched) {
            border-color: var(--primary);
            transform: scale(1.05);
        }

        .connect-item.selected {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .connect-item.matched {
            background: var(--success);
            color: white;
            border-color: var(--success);
            cursor: default;
        }

        /* ========== CORRIDA MALUCA ========== */
        .racing-track {
            position: relative;
            height: 400px;
            background: linear-gradient(to bottom, #87CEEB 0%, #98D8C8 50%, #F7DC6F 100%);
            border-radius: 20px;
            padding: 20px;
            margin: 20px 0;
            overflow: hidden;
        }

        .racing-player {
            position: absolute;
            bottom: 20px;
            left: 0;
            font-size: 50px;
            transition: left 1s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            z-index: 10;
        }

        .racing-checkpoint {
            position: absolute;
            bottom: 10px;
            height: 380px;
            width: 3px;
            background: rgba(255,255,255,0.5);
            border-left: 3px dashed white;
        }

        .racing-flag {
            position: absolute;
            bottom: 60px;
            right: 20px;
            font-size: 60px;
            animation: wave 1s infinite;
        }

        @keyframes wave {
            0%, 100% { transform: rotate(-5deg); }
            50% { transform: rotate(5deg); }
        }

        .racing-stats {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
            padding: 15px;
            background: rgba(255,255,255,0.2);
            border-radius: 15px;
        }

        .racing-stat {
            text-align: center;
        }

        .racing-stat-value {
            font-size: 24px;
            font-weight: 900;
            color: white;
        }

        .racing-stat-label {
            font-size: 12px;
            color: white;
            font-weight: 600;
        }

        /* ========== SUBIR NA √ÅRVORE ========== */
        .tree-container {
            position: relative;
            height: 500px;
            background: linear-gradient(to bottom, #E3F2FD 0%, #C8E6C9 100%);
            border-radius: 20px;
            padding: 20px;
            margin: 20px 0;
            overflow: hidden;
        }

        .tree-trunk {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 200px;
            background: #8D6E63;
            border-radius: 30px 30px 0 0;
        }

        .tree-branches {
            position: absolute;
            width: 100%;
            height: 100%;
        }

        .tree-branch {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            width: 150px;
            height: 40px;
            background: #66BB6A;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            transition: all 0.5s;
        }

        .tree-climber {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            font-size: 50px;
            transition: bottom 1s ease-out;
            z-index: 100;
        }

        .tree-prize {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 60px;
            animation: bounce 2s infinite;
        }

        /* ========== QUEBRA-CABE√áA ========== */
        .puzzle-container {
            position: relative;
            width: 100%;
            max-width: 400px;
            margin: 20px auto;
            aspect-ratio: 1;
            background: #E0E0E0;
            border-radius: 20px;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 5px;
            padding: 5px;
        }

        .puzzle-piece {
            background: linear-gradient(135deg, #BDBDBD, #9E9E9E);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            transition: all 0.5s;
            position: relative;
            overflow: hidden;
        }

        .puzzle-piece.revealed {
            background: linear-gradient(135deg, var(--primary), var(--purple));
            animation: revealPiece 0.5s;
        }

        @keyframes revealPiece {
            0% { transform: scale(0) rotate(180deg); }
            100% { transform: scale(1) rotate(0deg); }
        }

        .puzzle-piece.revealed::after {
            content: '‚úì';
            color: white;
            font-size: 50px;
            font-weight: 900;
        }

        .puzzle-progress-text {
            text-align: center;
            font-size: 18px;
            font-weight: 700;
            color: var(--dark);
            margin: 15px 0;
        }

        /* ========== FOGUETE ESPACIAL ========== */
        .rocket-space {
            position: relative;
            height: 500px;
            background: linear-gradient(to bottom, #000428 0%, #004e92 100%);
            border-radius: 20px;
            padding: 20px;
            margin: 20px 0;
            overflow: hidden;
        }

        .stars-bg {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
        }

        .star-small {
            position: absolute;
            width: 2px;
            height: 2px;
            background: white;
            border-radius: 50%;
            animation: twinkle 2s infinite;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }

        .rocket {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 60px;
            transition: bottom 1s ease-out;
            z-index: 10;
        }

        .rocket.launching {
            animation: launch 2s ease-out forwards;
        }

        @keyframes launch {
            0% { bottom: 20px; transform: translateX(-50%) scale(1); }
            100% { bottom: 600px; transform: translateX(-50%) scale(0.3); }
        }

        .fuel-container {
            position: absolute;
            bottom: 20px;
            left: 20px;
            right: 20px;
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
            padding: 15px;
        }

        .fuel-label {
            color: white;
            font-weight: 700;
            margin-bottom: 10px;
            text-align: center;
        }

        .fuel-bar {
            height: 30px;
            background: rgba(255,255,255,0.2);
            border-radius: 15px;
            overflow: hidden;
            position: relative;
        }

        .fuel-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            border-radius: 15px;
            transition: width 0.5s;
            width: 0%;
        }

        .planets {
            position: absolute;
            width: 100%;
            height: 100%;
        }

        .planet {
            position: absolute;
            font-size: 40px;
            animation: float 3s ease-in-out infinite;
        }

        /* ========== CONTRA O REL√ìGIO ========== */
        .clock-container {
            text-align: center;
            padding: 30px;
        }

        .clock-display {
            font-size: 80px;
            font-weight: 900;
            background: linear-gradient(135deg, var(--primary), var(--purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
        }

        .clock-display.warning {
            animation: pulse 0.5s infinite;
            color: var(--error);
        }

        .quick-stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 30px 0;
        }

        .quick-stat {
            text-align: center;
        }

        .quick-stat-value {
            font-size: 40px;
            font-weight: 900;
            background: linear-gradient(135deg, var(--success), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .quick-stat-label {
            font-size: 14px;
            color: #718096;
            font-weight: 700;
            margin-top: 5px;
        }

        /* ========== FEEDBACK ========== */
        .feedback {
            margin-top: 20px;
            padding: 25px;
            border-radius: 20px;
            animation: fadeIn 0.5s;
        }

        .feedback-correct {
            background: linear-gradient(135deg, var(--success), #00E4B4);
            color: white;
        }

        .feedback-wrong {
            background: linear-gradient(135deg, var(--error), #FF8FA3);
            color: white;
        }

        .feedback-title {
            font-size: 26px;
            font-weight: 900;
            margin-bottom: 12px;
            text-align: center;
        }

        .feedback-points {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 15px;
            text-align: center;
        }

        .explanation {
            background: rgba(255,255,255,0.2);
            padding: 15px;
            border-radius: 15px;
            margin-top: 15px;
            font-size: 15px;
            line-height: 1.6;
            font-weight: 600;
        }

        /* ========== TELA FINAL ========== */
        .final {
            text-align: center;
            padding: 40px 20px;
        }

        .final-trophy {
            font-size: 110px;
            margin-bottom: 20px;
            animation: bounce 1.5s infinite;
        }

        .final-score {
            font-size: 60px;
            font-weight: 900;
            background: linear-gradient(135deg, var(--primary), var(--purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 20px 0;
        }

        .final-message {
            font-size: 26px;
            font-weight: 900;
            color: var(--dark);
            margin: 20px 0;
        }

        .final-stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 30px 0;
        }

        .final-stat {
            text-align: center;
        }

        .final-stat-value {
            font-size: 40px;
            font-weight: 900;
            background: linear-gradient(135deg, var(--primary), var(--purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .final-stat-label {
            font-size: 14px;
            color: #718096;
            font-weight: 700;
        }

        /* ========== ERROR ========== */
        .error-message {
            background: linear-gradient(135deg, var(--error), #FF8FA3);
            color: white;
            padding: 25px;
            border-radius: 20px;
            margin: 20px 0;
            text-align: center;
        }

        .error-title {
            font-size: 26px;
            font-weight: 900;
            margin-bottom: 12px;
        }

        /* ========== SAVED LESSONS ========== */
        .saved-lesson-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 2px solid #E2E8F0;
            gap: 10px;
        }

        .saved-lesson-item:last-child {
            border-bottom: none;
        }

        .saved-lesson-name {
            font-weight: 700;
            color: var(--dark);
            flex: 1;
        }

        .saved-lesson-actions {
            display: flex;
            gap: 8px;
        }

        .saved-lesson-actions .btn {
            padding: 8px 15px;
            font-size: 13px;
        }

        /* ========== UTILITY ========== */
        .hidden { display: none !important; }

        /* ========== RESPONSIVE ========== */
        @media (max-width: 600px) {
            .logo { font-size: 36px; }
            .card { padding: 20px; }
            .question-text { font-size: 18px; }
            .option { padding: 15px; }
            .btn-group { flex-direction: column; }
            .final-stats { flex-direction: column; gap: 15px; }
            .memory-grid { grid-template-columns: repeat(3, 1fr); }
            .connect-container { grid-template-columns: 1fr; gap: 15px; }
            .mode-grid { grid-template-columns: 1fr; }
            .stats-grid { grid-template-columns: repeat(3, 1fr); }
        }
    </style>
</head>
<body>
    <!-- Formas flutuantes animadas -->
    <div class="floating-shapes">
        <div class="shape" style="font-size: 40px;">üåü</div>
        <div class="shape" style="font-size: 35px;">‚≠ê</div>
        <div class="shape" style="font-size: 45px;">‚ú®</div>
        <div class="shape" style="font-size: 38px;">üí´</div>
        <div class="shape" style="font-size: 42px;">üéØ</div>
    </div>

    <div class="container">
        <!-- HEADER -->
        <header class="header">
            <div class="logo">üéÆ SchoolQuest</div>
            <div class="subtitle">Aprender brincando √© muito mais divertido! üöÄ</div>
            
            <div class="user-info" id="userInfo">
                <div class="user-badge">
                    <span>üë§</span>
                    <span id="usernameDisplay">Carregando...</span>
                </div>
                <button class="btn-logout" onclick="logout()">üö™ Sair</button>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="points">0</div>
                    <div class="stat-label">üéØ Pontos</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stars">‚≠ê‚≠ê‚≠ê</div>
                    <div class="stat-label">Estrelas</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="level">1</div>
                    <div class="stat-label">üèÜ N√≠vel</div>
                </div>
            </div>

            <div class="progress-wrapper">
                <div class="progress-fill" id="progress"></div>
            </div>
        </header>

        <!-- UPLOAD CARD -->
        <div class="card" id="uploadCard">
            <h2 class="card-title">üéØ Pronto para a Aventura?</h2>

            <div class="tabs">
                <button class="tab-btn active" onclick="switchTab('image')">
                    üì∑ Foto
                </button>
                <button class="tab-btn" onclick="switchTab('text')">
                    ‚úèÔ∏è Texto
                </button>
                <button class="tab-btn" onclick="switchTab('saved')">
                    üìö Salvas
                </button>
            </div>

            <!-- IMAGE TAB -->
            <div id="imageTab">
                <div class="upload-zone" onclick="document.getElementById('fileInput').click()">
                    <div class="upload-icon">üì∏</div>
                    <div class="upload-text">Tire uma foto do dever de casa!</div>
                    <div class="upload-hint">Ou arraste a imagem aqui üé®</div>
                </div>
                <input type="file" id="fileInput" accept="image/*" capture="environment" class="hidden">

                <div id="preview" class="hidden preview">
                    <img id="previewImg" alt="Preview">
                    <button class="btn btn-primary btn-full" onclick="processImage()" style="margin-top: 20px;">
                        üöÄ Come√ßar a Aventura!
                    </button>
                </div>
            </div>

            <!-- TEXT TAB -->
            <div id="textTab" class="hidden">
                <textarea 
                    id="textInput" 
                    class="text-input" 
                    placeholder="Cole ou digite o texto do dever de casa aqui... üìù

Exemplo: 
Maria tem 5 ma√ß√£s e ganhou mais 3. Quantas ma√ß√£s ela tem agora?"></textarea>
                <button class="btn btn-primary btn-full" onclick="processText()" style="margin-top: 20px;">
                    üéØ Criar Quiz Divertido!
                </button>
            </div>

            <!-- SAVED LESSONS TAB -->
            <div id="savedTab" class="hidden">
                <div id="savedLessonsList" style="min-height: 200px;"></div>
            </div>
        </div>

        <!-- LOADING -->
        <div class="card hidden" id="loading">
            <div class="loading">
                <div class="spinner"></div>
                <div class="loading-text">üé® Criando seu jogo...</div>
                <div class="loading-hint">A intelig√™ncia artificial est√° preparando quest√µes super divertidas! ‚ú®</div>
            </div>
        </div>

        <!-- GAME AREA -->
        <div id="gameArea"></div>
    </div>

    <script>
        // ========== CONFIGURA√á√ÉO DA API ========== 
        const API_BASE_URL = (() => {
            const hostname = window.location.hostname;
            if (hostname === 'localhost' || hostname === '127.0.0.1') {
                return 'http://localhost:8000';
            }
            return 'https://schoolquest-aukm.onrender.com';
        })();

        console.log('üåê API configurada para:', API_BASE_URL);

        // ========== AUTENTICA√á√ÉO ========== 
        const token = localStorage.getItem('token');
        const username = localStorage.getItem('username');

        if (!token) {
            console.warn('‚ö†Ô∏è Token n√£o encontrado. Redirecionando...');
            window.location.href = '/login.html';
        }

        if (username) {
            document.getElementById('usernameDisplay').textContent = username;
        }

        function logout() {
            if (confirm('ü¶∏ Tem certeza que quer sair da aventura?')) {
                localStorage.removeItem('token');
                localStorage.removeItem('username');
                window.location.href = '/login.html';
            }
        }

        // ========== FETCH COM TIMEOUT ========== 
        async function fetchWithTimeout(url, options = {}, timeout = 30000) {
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), timeout);
            
            try {
                const response = await fetch(url, {
                    ...options,
                    signal: controller.signal
                });
                clearTimeout(timeoutId);
                return response;
            } catch (error) {
                clearTimeout(timeoutId);
                if (error.name === 'AbortError') {
                    throw new Error('‚è∞ Tempo esgotado. Tente novamente!');
                }
                throw error;
            }
        }

        // ========== CHAMADAS DE API ========== 
        async function callProcessImage(file) {
            const formData = new FormData();
            formData.append('file', file);

            const response = await fetchWithTimeout(`${API_BASE_URL}/api/process-image`, {
                method: 'POST',
                headers: { 'Authorization': `Bearer ${token}` },
                body: formData
            }, 60000);

            if (response.status === 401) {
                localStorage.clear();
                alert('‚è∞ Sess√£o expirada! Fa√ßa login novamente.');
                window.location.href = '/login.html';
                throw new Error('Sess√£o expirada');
            }

            if (!response.ok) {
                const error = await response.json().catch(() => ({}));
                throw new Error(error.detail || `Erro ${response.status}`);
            }

            return await response.json();
        }

        async function callProcessText(text) {
            const response = await fetchWithTimeout(`${API_BASE_URL}/api/process-text`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                },
                body: JSON.stringify({ text })
            }, 60000);

            if (response.status === 401) {
                localStorage.clear();
                alert('‚è∞ Sess√£o expirada! Fa√ßa login novamente.');
                window.location.href = '/login.html';
                throw new Error('Sess√£o expirada');
            }

            if (!response.ok) {
                const error = await response.json().catch(() => ({}));
                throw new Error(error.detail || `Erro ${response.status}`);
            }

            return await response.json();
        }

        // ========== GAME MODES ========== 
        const GAME_MODES = {
            MULTIPLE_CHOICE: 'multiple_choice',
            FILL_BLANK: 'fill_blank',
            MEMORY: 'memory',
            CONNECT: 'connect',
            RACING: 'racing',
            TREE_CLIMB: 'tree_climb',
            PUZZLE: 'puzzle',
            ROCKET: 'rocket',
            BEAT_CLOCK: 'beat_clock'
        };

        // ========== STATE ========== 
        let state = {
            questions: [],
            originalQuestions: [],
            currentIndex: 0,
            points: 0,
            stars: 3,
            level: 1,
            uploadedFile: null,
            currentMode: GAME_MODES.MULTIPLE_CHOICE,
            memoryFlipped: [],
            memoryMatched: [],
            memoryCards: [],
            connectSelected: null,
            connectMatches: [],
            connectPairs: [],
            racingPosition: 0,
            treeHeight: 0,
            puzzleRevealed: [],
            rocketFuel: 0,
            clockTime: 60,
            clockCorrect: 0,
            clockWrong: 0,
            clockInterval: null
        };

        // ========== CONVERTERS ========== 
        const questionConverters = {
            toMultipleChoice: (q) => q,
            
            toFillBlank: (q) => {
                const correctAnswer = q.options[q.correct];
                const sentence = q.question.replace('?', '').replace(/ü¶∏|üéØ|Super Her√≥i!|Sua miss√£o √©:/gi, '').trim();
                return {
                    ...q,
                    sentence: sentence,
                    blank: correctAnswer,
                    options: [...q.options].sort(() => Math.random() - 0.5)
                };
            },
            
            toMemory: (questions) => {
                const pairs = questions.slice(0, 6).map(q => ({
                    question: q.question.replace(/ü¶∏|üéØ|Super Her√≥i!|Sua miss√£o √©:/gi, '').substring(0, 45) + '...',
                    answer: q.options[q.correct],
                    explanation: q.explanation
                }));
                
                const cards = [];
                pairs.forEach((pair, i) => {
                    cards.push({ id: i * 2, type: 'question', text: pair.question, pairId: i, ...pair });
                    cards.push({ id: i * 2 + 1, type: 'answer', text: pair.answer, pairId: i, ...pair });
                });
                
                return cards.sort(() => Math.random() - 0.5);
            },
            
            toConnect: (questions) => {
                const pairs = questions.slice(0, 5).map((q, i) => ({
                    id: i,
                    question: q.question.replace(/ü¶∏|üéØ|Super Her√≥i!|Sua miss√£o √©:/gi, '').trim(),
                    answer: q.options[q.correct],
                    explanation: q.explanation,
                    points: q.points
                }));
                return pairs.sort(() => Math.random() - 0.5);
            }
        };

        // ========== TEMPLATES ========== 
        const templates = {
            modeSelector: () => `
                <div class="card">
                    <div class="mode-selector">
                        <div class="mode-title">üéØ Escolha Seu Jogo!</div>
                        <div class="mode-grid">
                            <div class="mode-card" onclick="selectMode('${GAME_MODES.MULTIPLE_CHOICE}')">
                                <div class="mode-icon">‚úÖ</div>
                                <div class="mode-label">Quiz</div>
                            </div>
                            <div class="mode-card" onclick="selectMode('${GAME_MODES.FILL_BLANK}')">
                                <div class="mode-icon">‚úèÔ∏è</div>
                                <div class="mode-label">Completar</div>
                            </div>
                            <div class="mode-card" onclick="selectMode('${GAME_MODES.MEMORY}')">
                                <div class="mode-icon">üß†</div>
                                <div class="mode-label">Mem√≥ria</div>
                            </div>
                            <div class="mode-card" onclick="selectMode('${GAME_MODES.CONNECT}')">
                                <div class="mode-icon">üîó</div>
                                <div class="mode-label">Ligar</div>
                            </div>
                            <div class="mode-card" onclick="selectMode('${GAME_MODES.RACING}')">
                                <div class="mode-icon">üèÉ</div>
                                <div class="mode-label">Corrida</div>
                            </div>
                            <div class="mode-card" onclick="selectMode('${GAME_MODES.TREE_CLIMB}')">
                                <div class="mode-icon">üå≥</div>
                                <div class="mode-label">√Årvore</div>
                            </div>
                            <div class="mode-card" onclick="selectMode('${GAME_MODES.PUZZLE}')">
                                <div class="mode-icon">üß©</div>
                                <div class="mode-label">Quebra-Cabe√ßa</div>
                            </div>
                            <div class="mode-card" onclick="selectMode('${GAME_MODES.ROCKET}')">
                                <div class="mode-icon">üöÄ</div>
                                <div class="mode-label">Foguete</div>
                            </div>
                            <div class="mode-card" onclick="selectMode('${GAME_MODES.BEAT_CLOCK}')">
                                <div class="mode-icon">‚ö°</div>
                                <div class="mode-label">Rel√≥gio</div>
                            </div>
                        </div>
                        <div class="btn-group">
                            <button class="btn btn-secondary" onclick="saveLesson()">üíæ Salvar</button>
                        </div>
                    </div>
                </div>
            `,

            multipleChoice: (q, index, total) => `
                <div class="card game">
                    <div class="question-header">
                        <div class="question-counter">Quest√£o ${index + 1}/${total}</div>
                        <div class="difficulty difficulty-${q.difficulty}">${q.difficulty}</div>
                    </div>

                    <div class="question-box">
                        <div class="question-text">${q.question}</div>
                    </div>

                    <div class="options">
                        ${q.options.map((opt, i) => `
                            <div class="option" onclick="selectAnswer(${i})">
                                <div class="option-letter">${String.fromCharCode(65 + i)}</div>
                                <div>${opt}</div>
                            </div>
                        `).join('')}
                    </div>

                    <div id="feedback"></div>
                </div>
            `,

            fillBlank: (q, index, total) => `
                <div class="card game">
                    <div class="question-header">
                        <div class="question-counter">Quest√£o ${index + 1}/${total}</div>
                        <div class="difficulty difficulty-${q.difficulty}">${q.difficulty}</div>
                    </div>

                    <div class="fill-blank-container">
                        <div class="sentence-with-blank">
                            ${q.sentence} <span class="blank-space" id="blankSpace">_______</span>
                        </div>
                        <div style="text-align: center; color: #718096; font-size: 14px; margin-top: 10px; font-weight: 600;">
                            ‚úèÔ∏è Complete com a palavra certa!
                        </div>
                    </div>

                    <div class="options">
                        ${q.options.map((opt, i) => `
                            <div class="option" onclick="selectFillBlank(${i}, '${opt.replace(/'/g, "\\'")}')">
                                <div class="option-letter">${String.fromCharCode(65 + i)}</div>
                                <div>${opt}</div>
                            </div>
                        `).join('')}
                    </div>

                    <div id="feedback"></div>
                </div>
            `,

            memory: (cards) => `
                <div class="card game">
                    <div class="card-title">üß† Jogo da Mem√≥ria</div>
                    <div style="text-align: center; color: #718096; margin-bottom: 20px; font-weight: 600;">
                        Encontre os pares de perguntas e respostas! üéØ
                    </div>

                    <div class="memory-grid" id="memoryGrid">
                        ${cards.map((card, i) => `
                            <div class="memory-card" data-id="${i}" data-pair="${card.pairId}" onclick="flipCard(${i})">
                                ‚ùì
                            </div>
                        `).join('')}
                    </div>

                    <div id="feedback"></div>

                    <div class="btn-group">
                        <button class="btn btn-accent" onclick="resetMemory()">
                            üîÑ Reiniciar
                        </button>
                        <button class="btn btn-secondary" onclick="showFinalScreen()">
                            ‚úÖ Finalizar
                        </button>
                    </div>
                </div>
            `,

            connect: (pairs) => `
                <div class="card game">
                    <div class="card-title">üîó Ligar Pontos</div>
                    <div style="text-align: center; color: #718096; margin-bottom: 20px; font-weight: 600;">
                        Conecte cada pergunta com sua resposta! üéØ
                    </div>

                    <div class="connect-container">
                        <div class="connect-column">
                            ${pairs.map((p, i) => `
                                <div class="connect-item" data-type="question" data-id="${i}" onclick="selectConnect('question', ${i})">
                                    ${p.question}
                                </div>
                            `).join('')}
                        </div>
                        <div class="connect-column">
                            ${pairs.map((p, i) => {
                                const shuffledIndex = Math.floor(Math.random() * 1000);
                                return `
                                    <div class="connect-item" data-type="answer" data-id="${i}" data-shuffle="${shuffledIndex}" onclick="selectConnect('answer', ${i})">
                                        ${p.answer}
                                    </div>
                                `;
                            }).sort((a, b) => {
                                const aNum = parseInt(a.match(/data-shuffle="(\d+)"/)[1]);
                                const bNum = parseInt(b.match(/data-shuffle="(\d+)"/)[1]);
                                return aNum - bNum;
                            }).join('')}
                        </div>
                    </div>

                    <div id="feedback"></div>

                    <div class="btn-group">
                        <button class="btn btn-accent" onclick="resetConnect()">
                            üîÑ Reiniciar
                        </button>
                        <button class="btn btn-secondary" onclick="showFinalScreen()">
                            ‚úÖ Finalizar
                        </button>
                    </div>
                </div>
            `,

            feedback: (correct, points, explanation) => `
                <div class="feedback feedback-${correct ? 'correct' : 'wrong'}">
                    <div class="feedback-title">${correct ? 'üéâ Incr√≠vel!' : 'üí™ Quase l√°!'}</div>
                    <div class="feedback-points">
                        ${correct ? `+${points} pontos conquistados!` : 'N√£o desista, voc√™ consegue!'}
                    </div>
                    ${explanation ? `<div class="explanation">${explanation}</div>` : ''}
                    <button class="btn btn-primary btn-full" onclick="nextQuestion()" style="margin-top: 20px;">
                        Pr√≥xima Miss√£o! üöÄ
                    </button>
                </div>
            `,

            error: (message) => `
                <div class="card">
                    <div class="error-message">
                        <div class="error-title">‚ö†Ô∏è Ops!</div>
                        <div>${message}</div>
                    </div>
                    <button class="btn btn-primary btn-full" onclick="location.reload()">
                        üîÑ Tentar Novamente
                    </button>
                </div>
            `,

            racing: (q, index, total, position) => `
                <div class="card game">
                    <div class="card-title">üèÉ Corrida Maluca!</div>
                    
                    <div class="racing-track">
                        <div class="racing-player" id="racingPlayer" style="left: ${position}%;">üèÉ</div>
                        ${[0, 25, 50, 75, 100].map(pos => `<div class="racing-checkpoint" style="left: ${pos}%;"></div>`).join('')}
                        <div class="racing-flag">üèÅ</div>
                    </div>

                    <div class="racing-stats">
                        <div class="racing-stat">
                            <div class="racing-stat-value">${index + 1}/${total}</div>
                            <div class="racing-stat-label">Pergunta</div>
                        </div>
                        <div class="racing-stat">
                            <div class="racing-stat-value">${Math.round(position)}%</div>
                            <div class="racing-stat-label">Progresso</div>
                        </div>
                    </div>

                    <div class="question-box">
                        <div class="question-text">${q.question}</div>
                    </div>

                    <div class="options">
                        ${q.options.map((opt, i) => `
                            <div class="option" onclick="answerRacing(${i})">
                                <div class="option-letter">${String.fromCharCode(65 + i)}</div>
                                <div>${opt}</div>
                            </div>
                        `).join('')}
                    </div>

                    <div id="feedback"></div>
                </div>
            `,

            treeClimb: (q, index, total, height) => `
                <div class="card game">
                    <div class="card-title">üå≥ Subir na √Årvore!</div>
                    
                    <div class="tree-container">
                        <div class="tree-prize">üèÜ</div>
                        <div class="tree-branches">
                            ${[80, 60, 40, 20, 0].map((h, i) => `
                                <div class="tree-branch" style="bottom: ${h * 5 + 20}px;">
                                    ${i < index ? '‚úì' : (i === index ? '‚ùì' : 'üîí')}
                                </div>
                            `).join('')}
                        </div>
                        <div class="tree-trunk"></div>
                        <div class="tree-climber" id="treeClimber" style="bottom: ${height}px;">üßó</div>
                    </div>

                    <div style="text-align: center; color: #718096; font-weight: 600; margin: 15px 0;">
                        Galho ${index + 1}/${Math.min(5, total)} - Suba at√© o topo! üéØ
                    </div>

                    <div class="question-box">
                        <div class="question-text">${q.question}</div>
                    </div>

                    <div class="options">
                        ${q.options.map((opt, i) => `
                            <div class="option" onclick="answerTree(${i})">
                                <div class="option-letter">${String.fromCharCode(65 + i)}</div>
                                <div>${opt}</div>
                            </div>
                        `).join('')}
                    </div>

                    <div id="feedback"></div>
                </div>
            `,

            puzzle: (q, index, total, revealed) => `
                <div class="card game">
                    <div class="card-title">üß© Quebra-Cabe√ßa M√°gico!</div>
                    
                    <div class="puzzle-container">
                        ${[0,1,2,3,4,5,6,7,8].map(i => `
                            <div class="puzzle-piece ${revealed.includes(i) ? 'revealed' : ''}"></div>
                        `).join('')}
                    </div>

                    <div class="puzzle-progress-text">
                        Pe√ßas reveladas: ${revealed.length}/9 üé®
                    </div>

                    <div class="question-box">
                        <div class="question-text">${q.question}</div>
                    </div>

                    <div class="options">
                        ${q.options.map((opt, i) => `
                            <div class="option" onclick="answerPuzzle(${i})">
                                <div class="option-letter">${String.fromCharCode(65 + i)}</div>
                                <div>${opt}</div>
                            </div>
                        `).join('')}
                    </div>

                    <div id="feedback"></div>
                </div>
            `,

            rocket: (q, index, total, fuel) => `
                <div class="card game">
                    <div class="card-title">üöÄ Foguete Espacial!</div>
                    
                    <div class="rocket-space">
                        <div class="stars-bg">
                            ${[...Array(30)].map(() => `
                                <div class="star-small" style="
                                    left: ${Math.random() * 100}%; 
                                    top: ${Math.random() * 100}%;
                                    animation-delay: ${Math.random() * 2}s;
                                "></div>
                            `).join('')}
                        </div>
                        <div class="planets">
                            <div class="planet" style="top: 20%; right: 10%;">ü™ê</div>
                            <div class="planet" style="top: 60%; left: 15%;">üåé</div>
                        </div>
                        <div class="rocket" id="rocket">üöÄ</div>
                        <div class="fuel-container">
                            <div class="fuel-label">‚õΩ Combust√≠vel: ${fuel}%</div>
                            <div class="fuel-bar">
                                <div class="fuel-fill" id="fuelFill" style="width: ${fuel}%;"></div>
                            </div>
                        </div>
                    </div>

                    <div style="text-align: center; color: #718096; font-weight: 600; margin: 15px 0;">
                        Pergunta ${index + 1}/${total} - Abaste√ßa o foguete! üéØ
                    </div>

                    <div class="question-box">
                        <div class="question-text">${q.question}</div>
                    </div>

                    <div class="options">
                        ${q.options.map((opt, i) => `
                            <div class="option" onclick="answerRocket(${i})">
                                <div class="option-letter">${String.fromCharCode(65 + i)}</div>
                                <div>${opt}</div>
                            </div>
                        `).join('')}
                    </div>

                    <div id="feedback"></div>
                </div>
            `,

            beatClock: (q, index, timeLeft, correctCount, wrongCount) => `
                <div class="card game">
                    <div class="card-title">‚ö° Contra o Rel√≥gio!</div>
                    
                    <div class="clock-container">
                        <div class="clock-display ${timeLeft <= 10 ? 'warning' : ''}" id="clockDisplay">
                            ${Math.floor(timeLeft / 60)}:${(timeLeft % 60).toString().padStart(2, '0')}
                        </div>
                        
                        <div class="quick-stats">
                            <div class="quick-stat">
                                <div class="quick-stat-value">${correctCount}</div>
                                <div class="quick-stat-label">‚úÖ Certas</div>
                            </div>
                            <div class="quick-stat">
                                <div class="quick-stat-value">${wrongCount}</div>
                                <div class="quick-stat-label">‚ùå Erradas</div>
                            </div>
                            <div class="quick-stat">
                                <div class="quick-stat-value">${index + 1}</div>
                                <div class="quick-stat-label">üìä Total</div>
                            </div>
                        </div>
                    </div>

                    <div class="question-box">
                        <div class="question-text">${q.question}</div>
                    </div>

                    <div class="options">
                        ${q.options.map((opt, i) => `
                            <div class="option" onclick="answerClock(${i})">
                                <div class="option-letter">${String.fromCharCode(65 + i)}</div>
                                <div>${opt}</div>
                            </div>
                        `).join('')}
                    </div>

                    <div id="feedback"></div>
                </div>
            `
        };

        // ========== TAB SWITCHING ========== 
        function switchTab(tab) {
            const tabs = document.querySelectorAll('.tab-btn');
            tabs.forEach(t => t.classList.remove('active'));
            document.querySelector(`.tab-btn[onclick="switchTab('${tab}')"]`).classList.add('active');

            document.getElementById('imageTab').classList.add('hidden');
            document.getElementById('textTab').classList.add('hidden');
            document.getElementById('savedTab').classList.add('hidden');

            if (tab === 'image') {
                document.getElementById('imageTab').classList.remove('hidden');
            } else if (tab === 'text') {
                document.getElementById('textTab').classList.remove('hidden');
            } else if (tab === 'saved') {
                document.getElementById('savedTab').classList.remove('hidden');
                loadSavedLessons();
            }
        }

        // ========== FILE HANDLING ========== 
        const fileInput = document.getElementById('fileInput');
        const dropZone = document.querySelector('.upload-zone');

        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) handleFile(file);
        });

        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.style.borderColor = 'var(--primary)';
        });

        dropZone.addEventListener('dragleave', () => {
            dropZone.style.borderColor = 'var(--accent)';
        });

        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.style.borderColor = 'var(--accent)';
            const file = e.dataTransfer.files[0];
            if (file && file.type.startsWith('image/')) handleFile(file);
        });

        function handleFile(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                document.getElementById('previewImg').src = e.target.result;
                document.getElementById('preview').classList.remove('hidden');
                state.uploadedFile = file;
            };
            reader.readAsDataURL(file);
        }

        // ========== PROCESSING ========== 
        async function processImage() {
            if (!state.uploadedFile) return;
            
            showLoading();
            
            try {
                console.log('üöÄ Enviando imagem...');
                const data = await callProcessImage(state.uploadedFile);
                console.log('‚úÖ Quest√µes recebidas:', data);
                
                state.originalQuestions = data.questions;
                state.questions = data.questions;
                hideLoading();
                showModeSelector();
            } catch (error) {
                console.error('‚ùå Erro:', error);
                hideLoading();
                document.getElementById('gameArea').innerHTML = templates.error(error.message);
            }
        }

        async function processText() {
            const text = document.getElementById('textInput').value.trim();
            if (!text) {
                alert('ü¶∏ Por favor, insira algum texto para criar o jogo!');
                return;
            }
            
            showLoading();
            
            try {
                console.log('üöÄ Enviando texto...');
                const data = await callProcessText(text);
                console.log('‚úÖ Quest√µes recebidas:', data);
                
                state.originalQuestions = data.questions;
                state.questions = data.questions;
                hideLoading();
                showModeSelector();
            } catch (error) {
                console.error('‚ùå Erro:', error);
                hideLoading();
                document.getElementById('gameArea').innerHTML = templates.error(error.message);
            }
        }

        // ========== MODE SELECTION ========== 
        function showModeSelector() {
            document.getElementById('uploadCard').classList.add('hidden');
            
            const gameArea = document.getElementById('gameArea');
            gameArea.innerHTML = templates.modeSelector();
        }

        function selectMode(mode) {
            state.currentMode = mode;
            state.currentIndex = 0;
            state.memoryFlipped = [];
            state.memoryMatched = [];
            state.connectSelected = null;
            state.connectMatches = [];
            state.racingPosition = 0;
            state.treeHeight = 0;
            state.puzzleRevealed = [];
            state.rocketFuel = 0;
            state.clockTime = 60;
            state.clockCorrect = 0;
            state.clockWrong = 0;
            
            if (state.clockInterval) {
                clearInterval(state.clockInterval);
                state.clockInterval = null;
            }
            
            renderGame();
        }

        // ========== GAME RENDERING ========== 
        function renderGame() {
            const gameArea = document.getElementById('gameArea');
            
            switch(state.currentMode) {
                case GAME_MODES.MULTIPLE_CHOICE:
                    if (state.currentIndex < state.questions.length) {
                        const q = questionConverters.toMultipleChoice(state.questions[state.currentIndex]);
                        gameArea.innerHTML = templates.multipleChoice(q, state.currentIndex, state.questions.length);
                    } else {
                        showFinalScreen();
                    }
                    break;
                    
                case GAME_MODES.FILL_BLANK:
                    if (state.currentIndex < state.questions.length) {
                        const q = questionConverters.toFillBlank(state.questions[state.currentIndex]);
                        state.currentFillBlank = q;
                        gameArea.innerHTML = templates.fillBlank(q, state.currentIndex, state.questions.length);
                    } else {
                        showFinalScreen();
                    }
                    break;
                    
                case GAME_MODES.MEMORY:
                    const cards = questionConverters.toMemory(state.questions);
                    state.memoryCards = cards;
                    gameArea.innerHTML = templates.memory(cards);
                    break;
                    
                case GAME_MODES.CONNECT:
                    const pairs = questionConverters.toConnect(state.questions);
                    state.connectPairs = pairs;
                    gameArea.innerHTML = templates.connect(pairs);
                    break;

                case GAME_MODES.RACING:
                    if (state.currentIndex < state.questions.length) {
                        const q = state.questions[state.currentIndex];
                        gameArea.innerHTML = templates.racing(q, state.currentIndex, state.questions.length, state.racingPosition);
                    } else {
                        showFinalScreen();
                    }
                    break;

                case GAME_MODES.TREE_CLIMB:
                    if (state.currentIndex < Math.min(5, state.questions.length)) {
                        const q = state.questions[state.currentIndex];
                        gameArea.innerHTML = templates.treeClimb(q, state.currentIndex, state.questions.length, state.treeHeight);
                    } else {
                        showFinalScreen();
                    }
                    break;

                case GAME_MODES.PUZZLE:
                    if (state.currentIndex < state.questions.length && state.puzzleRevealed.length < 9) {
                        const q = state.questions[state.currentIndex];
                        gameArea.innerHTML = templates.puzzle(q, state.currentIndex, state.questions.length, state.puzzleRevealed);
                    } else {
                        showFinalScreen();
                    }
                    break;

                case GAME_MODES.ROCKET:
                    if (state.currentIndex < state.questions.length && state.rocketFuel < 100) {
                        const q = state.questions[state.currentIndex];
                        gameArea.innerHTML = templates.rocket(q, state.currentIndex, state.questions.length, state.rocketFuel);
                    } else {
                        if (state.rocketFuel >= 100) {
                            launchRocket();
                        } else {
                            showFinalScreen();
                        }
                    }
                    break;

                case GAME_MODES.BEAT_CLOCK:
                    if (state.clockTime > 0 && state.currentIndex < state.questions.length) {
                        const q = state.questions[state.currentIndex];
                        gameArea.innerHTML = templates.beatClock(q, state.currentIndex, state.clockTime, state.clockCorrect, state.clockWrong);
                        startClock();
                    } else {
                        showFinalScreen();
                    }
                    break;
            }
            
            updateProgress();
        }

        // ========== MULTIPLE CHOICE ========== 
        function selectAnswer(index) {
            const q = state.questions[state.currentIndex];
            const correct = index === q.correct;
            
            const options = document.querySelectorAll('.option');
            options.forEach(opt => opt.style.pointerEvents = 'none');
            
            if (correct) {
                options[index].classList.add('correct');
                state.points += q.points;
                updateStats();
            } else {
                options[index].classList.add('wrong');
                options[q.correct].classList.add('correct');
                state.stars = Math.max(1, state.stars - 1);
                updateStats();
            }
            
            document.getElementById('feedback').innerHTML = templates.feedback(correct, q.points, q.explanation);
        }

        // ========== FILL BLANK ========== 
        function selectFillBlank(index, selectedText) {
            const q = state.currentFillBlank;
            const correct = q.options[index] === q.blank;
            
            const options = document.querySelectorAll('.option');
            options.forEach(opt => opt.style.pointerEvents = 'none');
            
            const blankSpace = document.getElementById('blankSpace');
            blankSpace.textContent = selectedText;
            
            if (correct) {
                options[index].classList.add('correct');
                blankSpace.style.color = 'var(--success)';
                blankSpace.style.borderColor = 'var(--success)';
                state.points += state.questions[state.currentIndex].points;
                updateStats();
            } else {
                options[index].classList.add('wrong');
                blankSpace.style.color = 'var(--error)';
                blankSpace.style.borderColor = 'var(--error)';
                
                const correctIndex = q.options.indexOf(q.blank);
                if (correctIndex !== -1) {
                    options[correctIndex].classList.add('correct');
                }
                state.stars = Math.max(1, state.stars - 1);
                updateStats();
            }
            
            document.getElementById('feedback').innerHTML = templates.feedback(correct, state.questions[state.currentIndex].points, state.questions[state.currentIndex].explanation);
        }

        function nextQuestion() {
            state.currentIndex++;
            renderGame();
        }

        // ========== MEMORY GAME ========== 
        function flipCard(index) {
            const card = document.querySelector(`[data-id="${index}"]`);
            
            if (state.memoryMatched.includes(index) || state.memoryFlipped.includes(index) || state.memoryFlipped.length >= 2) {
                return;
            }
            
            const cardData = state.memoryCards[index];
            card.classList.add('flipped');
            card.textContent = cardData.text;
            state.memoryFlipped.push(index);
            
            if (state.memoryFlipped.length === 2) {
                setTimeout(() => checkMemoryMatch(), 600);
            }
        }

        function checkMemoryMatch() {
            const [first, second] = state.memoryFlipped;
            const card1 = state.memoryCards[first];
            const card2 = state.memoryCards[second];
            
            if (card1.pairId === card2.pairId) {
                const elem1 = document.querySelector(`[data-id="${first}"]`);
                const elem2 = document.querySelector(`[data-id="${second}"]`);
                elem1.classList.add('matched');
                elem2.classList.add('matched');
                state.memoryMatched.push(first, second);
                state.memoryFlipped = [];
                
                state.points += 20;
                updateStats();
                
                document.getElementById('feedback').innerHTML = templates.feedback(true, 20, card1.explanation);
                
                if (state.memoryMatched.length === state.memoryCards.length) {
                    setTimeout(() => showFinalScreen(), 2000);
                }
            } else {
                setTimeout(() => {
                    const elem1 = document.querySelector(`[data-id="${first}"]`);
                    const elem2 = document.querySelector(`[data-id="${second}"]`);
                    elem1.classList.remove('flipped');
                    elem2.classList.remove('flipped');
                    elem1.textContent = '‚ùì';
                    elem2.textContent = '‚ùì';
                    state.memoryFlipped = [];
                }, 1000);
            }
        }

        function resetMemory() {
            state.memoryFlipped = [];
            state.memoryMatched = [];
            state.points = 0;
            updateStats();
            renderGame();
        }

        // ========== CONNECT GAME ========== 
        function selectConnect(type, id) {
            const element = document.querySelector(`[data-type="${type}"][data-id="${id}"]`);
            
            if (element.classList.contains('matched')) return;
            
            if (!state.connectSelected) {
                state.connectSelected = { type, id, element };
                element.classList.add('selected');
            } else {
                if (state.connectSelected.type === type) {
                    state.connectSelected.element.classList.remove('selected');
                    state.connectSelected = { type, id, element };
                    element.classList.add('selected');
                } else {
                    const questionId = type === 'question' ? id : state.connectSelected.id;
                    const answerId = type === 'answer' ? id : state.connectSelected.id;
                    
                    if (questionId === answerId) {
                        element.classList.add('matched');
                        element.classList.remove('selected');
                        state.connectSelected.element.classList.add('matched');
                        state.connectSelected.element.classList.remove('selected');
                        state.connectMatches.push({ questionId, answerId });
                        
                        state.points += state.connectPairs[questionId].points;
                        updateStats();
                        
                        document.getElementById('feedback').innerHTML = templates.feedback(true, state.connectPairs[questionId].points, state.connectPairs[questionId].explanation);
                        
                        state.connectSelected = null;
                        
                        if (state.connectMatches.length === state.connectPairs.length) {
                            setTimeout(() => showFinalScreen(), 2000);
                        }
                    } else {
                        element.classList.add('wrong');
                        state.connectSelected.element.classList.add('wrong');
                        
                        setTimeout(() => {
                            element.classList.remove('wrong', 'selected');
                            state.connectSelected.element.classList.remove('wrong', 'selected');
                            state.connectSelected = null;
                        }, 1000);
                        
                        state.stars = Math.max(1, state.stars - 1);
                        updateStats();
                    }
                }
            }
        }

        function resetConnect() {
            state.connectSelected = null;
            state.connectMatches = [];
            state.points = 0;
            updateStats();
            renderGame();
        }

        // ========== RACING GAME ========== 
        function answerRacing(index) {
            const q = state.questions[state.currentIndex];
            const correct = index === q.correct;
            
            const options = document.querySelectorAll('.option');
            options.forEach(opt => opt.style.pointerEvents = 'none');
            
            if (correct) {
                options[index].classList.add('correct');
                state.racingPosition += (100 / state.questions.length);
                state.points += q.points;
                updateStats();
                
                const player = document.getElementById('racingPlayer');
                if (player) {
                    player.style.left = state.racingPosition + '%';
                }
            } else {
                options[index].classList.add('wrong');
                options[q.correct].classList.add('correct');
                state.stars = Math.max(1, state.stars - 1);
                updateStats();
            }
            
            document.getElementById('feedback').innerHTML = templates.feedback(correct, q.points, q.explanation);
        }

        // ========== TREE CLIMB GAME ========== 
        function answerTree(index) {
            const q = state.questions[state.currentIndex];
            const correct = index === q.correct;
            
            const options = document.querySelectorAll('.option');
            options.forEach(opt => opt.style.pointerEvents = 'none');
            
            if (correct) {
                options[index].classList.add('correct');
                state.treeHeight += 100;
                state.points += q.points;
                updateStats();
                
                const climber = document.getElementById('treeClimber');
                if (climber) {
                    climber.style.bottom = state.treeHeight + 'px';
                }

                if (state.currentIndex >= 4) {
                    setTimeout(() => {
                        alert('üèÜ PARAB√âNS! Voc√™ chegou ao topo da √°rvore!');
                        showFinalScreen();
                    }, 1500);
                    return;
                }
            } else {
                options[index].classList.add('wrong');
                options[q.correct].classList.add('correct');
                state.stars = Math.max(1, state.stars - 1);
                updateStats();
            }
            
            document.getElementById('feedback').innerHTML = templates.feedback(correct, q.points, q.explanation);
        }

        // ========== PUZZLE GAME ========== 
        function answerPuzzle(index) {
            const q = state.questions[state.currentIndex];
            const correct = index === q.correct;
            
            const options = document.querySelectorAll('.option');
            options.forEach(opt => opt.style.pointerEvents = 'none');
            
            if (correct) {
                options[index].classList.add('correct');
                state.puzzleRevealed.push(state.currentIndex % 9);
                state.points += q.points;
                updateStats();

                if (state.puzzleRevealed.length >= 9) {
                    setTimeout(() => {
                        alert('üé® PARAB√âNS! Voc√™ completou o quebra-cabe√ßa!');
                        showFinalScreen();
                    }, 1500);
                    return;
                }
            } else {
                options[index].classList.add('wrong');
                options[q.correct].classList.add('correct');
                state.stars = Math.max(1, state.stars - 1);
                updateStats();
            }
            
            document.getElementById('feedback').innerHTML = templates.feedback(correct, q.points, q.explanation);
        }

        // ========== ROCKET GAME ========== 
        function answerRocket(index) {
            const q = state.questions[state.currentIndex];
            const correct = index === q.correct;
            
            const options = document.querySelectorAll('.option');
            options.forEach(opt => opt.style.pointerEvents = 'none');
            
            if (correct) {
                options[index].classList.add('correct');
                state.rocketFuel += 20;
                if (state.rocketFuel > 100) state.rocketFuel = 100;
                state.points += q.points;
                updateStats();
                
                const fuelFill = document.getElementById('fuelFill');
                if (fuelFill) {
                    fuelFill.style.width = state.rocketFuel + '%';
                }

                if (state.rocketFuel >= 100) {
                    setTimeout(() => launchRocket(), 1500);
                    return;
                }
            } else {
                options[index].classList.add('wrong');
                options[q.correct].classList.add('correct');
                state.stars = Math.max(1, state.stars - 1);
                updateStats();
            }
            
            document.getElementById('feedback').innerHTML = templates.feedback(correct, q.points, q.explanation);
        }

        function launchRocket() {
            const rocket = document.getElementById('rocket');
            if (rocket) {
                rocket.classList.add('launching');
            }
            
            setTimeout(() => {
                alert('üöÄ DECOLAGEM! Voc√™ abasteceu o foguete completamente!');
                showFinalScreen();
            }, 2000);
        }

        // ========== BEAT CLOCK GAME ========== 
        function startClock() {
            if (state.clockInterval) {
                clearInterval(state.clockInterval);
            }
            
            state.clockInterval = setInterval(() => {
                state.clockTime--;
                
                const clockDisplay = document.getElementById('clockDisplay');
                if (clockDisplay) {
                    const mins = Math.floor(state.clockTime / 60);
                    const secs = state.clockTime % 60;
                    clockDisplay.textContent = `${mins}:${secs.toString().padStart(2, '0')}`;
                    
                    if (state.clockTime <= 10) {
                        clockDisplay.classList.add('warning');
                    }
                }
                
                if (state.clockTime <= 0) {
                    clearInterval(state.clockInterval);
                    state.clockInterval = null;
                    setTimeout(() => showFinalScreen(), 500);
                }
            }, 1000);
        }

        function answerClock(index) {
            const q = state.questions[state.currentIndex];
            const correct = index === q.correct;
            
            const options = document.querySelectorAll('.option');
            options.forEach(opt => opt.style.pointerEvents = 'none');
            
            if (correct) {
                options[index].classList.add('correct');
                state.clockCorrect++;
                state.points += q.points;
                updateStats();
            } else {
                options[index].classList.add('wrong');
                options[q.correct].classList.add('correct');
                state.clockWrong++;
                state.stars = Math.max(1, state.stars - 1);
                updateStats();
            }
            
            setTimeout(() => {
                state.currentIndex++;
                if (state.currentIndex < state.questions.length && state.clockTime > 0) {
                    renderGame();
                } else {
                    if (state.clockInterval) {
                        clearInterval(state.clockInterval);
                        state.clockInterval = null;
                    }
                    showFinalScreen();
                }
            }, 1000);
        }

        // ========== SAVED LESSONS ========== 
        function getSavedLessons() {
            return JSON.parse(localStorage.getItem('savedLessons') || '[]');
        }

        function saveLesson() {
            if (state.originalQuestions.length === 0) {
                alert("‚ö†Ô∏è N√£o h√° nenhuma li√ß√£o para salvar!");
                return;
            }
            const lessonName = prompt("üìö Digite um nome para esta li√ß√£o:", `Li√ß√£o de ${new Date().toLocaleDateString()}`);
            if (lessonName) {
                const savedLessons = getSavedLessons();
                savedLessons.push({
                    name: lessonName,
                    questions: state.originalQuestions,
                    createdAt: new Date().toISOString()
                });
                localStorage.setItem('savedLessons', JSON.stringify(savedLessons));
                alert(`‚úÖ Li√ß√£o "${lessonName}" salva com sucesso!`);
                loadSavedLessons();
            }
        }

        function loadSavedLessons() {
            const savedLessons = getSavedLessons();
            const listDiv = document.getElementById('savedLessonsList');
            if (savedLessons.length === 0) {
                listDiv.innerHTML = '<p style="text-align: center; color: #718096; padding: 40px; font-weight: 600;">üìö Nenhuma li√ß√£o salva ainda.<br>Salve suas li√ß√µes favoritas!</p>';
                return;
            }

            listDiv.innerHTML = savedLessons.map((lesson, index) => `
                <div class="saved-lesson-item">
                    <span class="saved-lesson-name">${lesson.name}</span>
                    <div class="saved-lesson-actions">
                        <button class="btn btn-primary" onclick="playSavedLesson(${index})">‚ñ∂Ô∏è Jogar</button>
                        <button class="btn btn-accent" onclick="deleteSavedLesson(${index})">üóëÔ∏è</button>
                    </div>
                </div>
            `).join('');
        }

        function playSavedLesson(index) {
            const savedLessons = getSavedLessons();
            const lesson = savedLessons[index];
            if (lesson) {
                state.originalQuestions = lesson.questions;
                state.questions = lesson.questions;
                showModeSelector();
            }
        }

        function deleteSavedLesson(index) {
            if (confirm("üóëÔ∏è Tem certeza que deseja excluir esta li√ß√£o?")) {
                let savedLessons = getSavedLessons();
                savedLessons.splice(index, 1);
                localStorage.setItem('savedLessons', JSON.stringify(savedLessons));
                loadSavedLessons();
            }
        }

        // ========== STATS & PROGRESS ========== 
        function updateStats() {
            document.getElementById('points').textContent = state.points;
            document.getElementById('stars').textContent = '‚≠ê'.repeat(state.stars);
            document.getElementById('level').textContent = state.level;
        }

        function updateProgress() {
            let progress = 0;
            
            if (state.currentMode === GAME_MODES.MULTIPLE_CHOICE || state.currentMode === GAME_MODES.FILL_BLANK) {
                progress = (state.currentIndex / state.questions.length) * 100;
            } else if (state.currentMode === GAME_MODES.MEMORY) {
                progress = (state.memoryMatched.length / state.memoryCards.length) * 100;
            } else if (state.currentMode === GAME_MODES.CONNECT) {
                progress = (state.connectMatches.length / state.connectPairs.length) * 100;
            }
            
            document.getElementById('progress').style.width = progress + '%';
        }

        // ========== FINAL SCREEN ========== 
        function showFinalScreen() {
            const gameArea = document.getElementById('gameArea');
            const totalQuestions = state.questions.length;
            
            let trophy = 'üèÜ';
            let message = 'Voc√™ √© incr√≠vel, Super Her√≥i!';
            
            if (state.points >= totalQuestions * 15) {
                trophy = 'üëë';
                message = 'PERFEITO! Voc√™ √© um G√äNIO!';
                state.level++;
            } else if (state.points >= totalQuestions * 10) {
                trophy = 'ü•á';
                message = 'EXCELENTE! Voc√™ mandou muito bem!';
            } else if (state.points >= totalQuestions * 5) {
                trophy = 'ü•à';
                message = 'MUITO BOM! Continue assim!';
            } else {
                trophy = 'ü•â';
                message = 'BOM TRABALHO! Pratique mais!';
            }
            
            updateStats();
            
            gameArea.innerHTML = `
                <div class="card final">
                    <div class="final-trophy">${trophy}</div>
                    <div class="final-message">${message}</div>
                    <div class="final-score">${state.points}</div>
                    <div style="color: #718096; margin-bottom: 30px; font-weight: 700; font-size: 18px;">pontos conquistados!</div>
                    
                    <div class="final-stats">
                        <div class="final-stat">
                            <div class="final-stat-value">${totalQuestions}</div>
                            <div class="final-stat-label">Quest√µes</div>
                        </div>
                        <div class="final-stat">
                            <div class="final-stat-value">${state.stars}</div>
                            <div class="final-stat-label">Estrelas</div>
                        </div>
                        <div class="final-stat">
                            <div class="final-stat-value">${state.level}</div>
                            <div class="final-stat-label">N√≠vel</div>
                        </div>
                    </div>

                    <div class="btn-group">
                        <button class="btn btn-primary" onclick="location.reload()">
                            üè† Nova Aventura
                        </button>
                        <button class="btn btn-accent" onclick="restartWithNewMode()">
                            üîÑ Outro Jogo
                        </button>
                    </div>
                </div>
            `;
        }

        function restartWithNewMode() {
            state.currentIndex = 0;
            state.points = 0;
            state.stars = 3;
            updateStats();
            showModeSelector();
        }

        // ========== LOADING ========== 
        function showLoading() {
            document.getElementById('uploadCard').classList.add('hidden');
            document.getElementById('loading').classList.remove('hidden');
        }

        function hideLoading() {
            document.getElementById('loading').classList.add('hidden');
        }

        // ========== INIT ========== 
        updateStats();
        loadSavedLessons();
    </script>
</body>
</html>